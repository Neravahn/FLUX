<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flux - Correlation Analysis</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        @font-face {
            font-family :'comforta-regular';
            src : url("{{ url_for('static', filename = 'fonts/Comfortaa-VariableFont_wght.ttf')}}") format('truetype');

        }
        body{
            background-color: #000;
            color: #fff;
            font-family:  'comforta-regular';
            display:flex;
            flex-direction: column;
            align-items: center;
            margin : 0;
            padding: 40px 0;
            min-height: 100vh;
        }

        h2{
            font-size: 1.8rem;
            align-items: center;
            padding: 20px;
            border-radius: 16px;
            display: flex;
            flex-direction: column;
            gap : 20px;
            width : 340px;
            margin-bottom : 40 px;

        }
        form {
            background-color: #0d0d0d;
            padding : 30px;
            border-radius : 16px;
            display:flex;
            flex-direction: column;
            gap: 20px;
            width: 340px;
            margin-bottom: 40px;



        }
        .form-group{
            display: flex;
            flex-direction: column;

        }

        .date-row{
            display:flex;
            justify-content:  space-between;
            gap : 12px;
        }

        .date-row.form-group{
            flex:1;

        }
        label {
            font-size: 0.9rem;
            color : #bfbfbf;
            margin-bottom:5px;
        }
        select, input[type = 'date']{
            background-color: #111;
            color:#9b9b9b;
            border: 1px solid #222;
            border-radius: 8px;
            padding:10px;
            font-size: 0.9rem;
            transition: 0.3s;


        }

        button{
            background-color: transparent;
            color: #fff;
            border: 1px solid #333;
            border-radius : 8px;
            padding: 10px;
            font-size: 1rem;
            font-weight: 500;
            cursor:pointer;
            transition : all 0.3s ease;

        }
        button:hover{
            background-color: #f1f1f1;
            color : #000;

        }

        #chart-container{
            width : 85%;
            max-width : 700px;

        }

        .result-card{
            background-color: #0d0d0d;
            padding :20px 30px;
            border-radius : 16px;
            max-width: 700px;
            text-align: center;
            margin-top: 30px;

        }

        .result-card h3 {
            color: #00ffff;
            margin-bottom:10px;

        }





    </style>
</head>
<body>
    <h2>Correlation Analysis</h2>

    <form id ='correlationForm'>
        <div class = ' form-group'>
            <label for='ticker_1'>Select 1st Stock</label>
            <select id = 'ticker_1' name = 'ticker_1' required>
                <option value="AAPL">Apple (AAPL)</option>
                <option value="GOOGL">Google (GOOGL)</option>
                <option value="MSFT">Microsoft (MSFT)</option>
                <option value="TSLA">Tesla (TSLA)</option>
                <option value="AMZN">Amazom (AMZN)</option>
            </select>
        </div>

        <div class="form-group">
            <select id = 'ticker_2' name = 'ticker_2' required>
                <option value="AAPL">Apple (AAPL)</option>
                <option value="GOOGL">Google (GOOGL)</option>
                <option value="MSFT">Microsoft (MSFT)</option>
                <option value="TSLA">Tesla (TSLA)</option>
                <option value="AMZN">Amazom (AMZN)</option>
            </select>
        </div>

        <div class ="date-row">
            <div class="form-group">
                <label for="start">Start Date</label>
                <input type="date" id="start" name="start_date" required>
            </div>

            <div class="form-group">
                <label for="end">End Date</label>
                <input type="date" id="end" name="end_date" required>
            </div>
        </div>

        <button type="submit">ANALYSE</button>
    </form>

    <div class="result-card" id="result" style="display:none;"></div>
    <h3 id="corr-value"></h3>
    <p id="interpretation"></p>

    <div id="chart-container">
        <canvas id="scatterChart"></canvas>
    </div>
    
    <script>
        const form = document.getElementById('correlationForm');
        const resultCard = document.getElementById('result')
        const corrValue = document.getElementById('corr-value')
        const interpretation = document.getElementById('interpretation');
        let chart;

        form.addEventListener('submit', async (e) => {
            e.preventDefault()

            resultCard.style.display = 'none';

            const payload = {
                ticker_1 : form.ticker_1.value,
                ticker_2 : form.ticker_2.value,
                start_date : form.start_date.value,
                end_date: form.end_date.value
            };

            

            const res = await fetch('/correlation_analysis', {
                method : 'POST',
                headers: {'Content-Type':'application/json'},
                body: JSON.stringify(payload)
            });


            const data = await res.json();


            // SHOWING RESULTS

            corrValue.textContent = `Correlation : ${data.corr}`;
            interpretation.textContent = data.interpretation;
            resultCard.style.display = 'block';

            //DESTROY OLD CHART IF EXIST
            if(chart) chart.destroy();

            //NOW CREATING SCATTER CHART


            const ctx = document.getElementById('scatterChart').getContext('2d');

            chart = new Chart(ctx, {
                type : 'scatter',
                data:{
                    datasets :[{
                        label:' Daily Returns',
                        data: data.points,
                        backgroundColor: 'rgba(0, 255, 255,0.6)',
                        borderColor : '#00fff'
                    }]
                },



                options :{
                    plugins: {
                        legend: {labels: {color: '#fff'}},
                        title: {
                            display : true,
                            text : `${payload.ticker_1} vs ${payload.ticker_2} Returns`,
                            color : '#fff'
                                          
                        }

                    },


                    scales :{
                        x: {
                            title :{display:true, text:`${payload.ticker_1} Returns (%)` , color:'#fff'},
                            grid: {color : '#222'},
                            ticks : {color :'#aaa'}
                        },


                        y : {
                            title :{display:true, text:`${payload.ticker_2} Returns (%)` , color:'#fff'},
                            grid: {color : '#222'},
                            ticks : {color :'#aaa'}
                        }



                    }
                }
                



                
            });



        });
    </script>
</body>
</html>
